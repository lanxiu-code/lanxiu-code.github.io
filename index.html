<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>éšæœºé…å¯¹æŠ½ç­¾</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Arial', sans-serif;
      }

      body {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        color: white;
      }

      .container {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        margin: 20px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-size: 28px;
      }

      .input-section {
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        backdrop-filter: blur(5px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      textarea {
        width: 100%;
        height: 150px;
        padding: 10px;
        border: none;
        border-radius: 10px;
        margin-bottom: 15px;
        font-size: 16px;
        resize: none;
      }

      button {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 30px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        margin-bottom: 10px;
      }

      button:hover {
        background: #ff5252;
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      .result-section {
        display: none;
        margin-top: 20px;
      }

      .result-card {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        backdrop-filter: blur(5px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .user-pair {
        font-size: 20px;
        font-weight: bold;
        margin: 15px 0;
      }

      .pair-label {
        font-size: 14px;
        opacity: 0.8;
        margin-bottom: 5px;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 20px;
      }

      .person-card {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .person-card:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px);
      }

      .person-name {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .person-pair {
        font-size: 14px;
        opacity: 0.8;
      }

      .reset-btn {
        margin-top: 20px;
        background: #4ecdc4;
        box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
      }

      .reset-btn:hover {
        background: #3dbeb5;
      }

      .save-btn {
        background: #9c88ff;
        box-shadow: 0 4px 15px rgba(156, 136, 255, 0.4);
      }

      .save-btn:hover {
        background: #8470ff;
      }

      .clear-btn {
        background: #ff7979;
        box-shadow: 0 4px 15px rgba(255, 121, 121, 0.4);
      }

      .clear-btn:hover {
        background: #ff6348;
      }

      .notification {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .notification.show {
        opacity: 1;
      }

      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: #f00;
        opacity: 0;
        z-index: 1000;
        animation: confetti-fall 3s ease-in-out forwards;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(-100px) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      .my-result {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: #ff6b6b;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .my-result:hover {
        transform: scale(1.1);
      }

      .my-result-tooltip {
        position: fixed;
        bottom: 90px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 14px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 1001;
        white-space: nowrap;
      }

      .my-result:hover + .my-result-tooltip,
      .my-result:focus + .my-result-tooltip {
        opacity: 1;
      }

      .user-select {
        margin-bottom: 15px;
        text-align: center;
      }

      .user-select label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .user-select select {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 16px;
      }

      .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
        font-size: 18px;
      }

      .spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .pair-pair {
        margin-top: 20px;
        background: rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 10px;
      }

      .pair-title {
        text-align: center;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .pairs-display {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .pair-item {
        background: rgba(255, 255, 255, 0.3);
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”’ éšæœºé…å¯¹æŠ½ç­¾ ğŸ”’</h1>

      <div class="input-section">
        <textarea id="nameInput" placeholder="è¯·è¾“å…¥å‚ä¸äººå‘˜åå•ï¼Œæ¯è¡Œä¸€ä¸ªäººå"></textarea>
        <button id="pairBtn">å¼€å§‹éšæœºé…å¯¹</button>
        <button id="saveBtn" class="save-btn" style="display: none">ä¿å­˜ç»“æœ</button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨ç”Ÿæˆé…å¯¹ï¼Œè¯·ç¨å€™...</div>
      </div>

      <div class="result-section" id="resultSection">
        <h2>ä¸ªäººé…å¯¹ç»“æœ</h2>
        <div class="result-card" id="userResultCard">
          <div class="pair-label">è¯·é€‰æ‹©æ‚¨çš„èº«ä»½</div>
          <div class="user-select" id="userSelect">
            <select id="nameSelect">
              <option value="">-- è¯·é€‰æ‹©æ‚¨çš„åå­— --</option>
            </select>
          </div>
          <div class="user-pair" id="userPair"></div>
        </div>

        <div class="pair-pair" id="pairsDisplay" style="display: none">
          <div class="pair-title">æ‰€æœ‰é…å¯¹ç»“æœ</div>
          <div class="pairs-display" id="pairsContainer"></div>
        </div>

        <h3>æ‰€æœ‰äººå‘˜</h3>
        <div class="dashboard" id="dashboard"></div>

        <button class="reset-btn" id="resetBtn">é‡æ–°æŠ½ç­¾</button>
        <button class="clear-btn" id="clearBtn">æ¸…é™¤ç»“æœ</button>
      </div>
    </div>

    <div class="my-result" id="myResultIcon">?</div>
    <div class="my-result-tooltip" id="myResultTooltip"></div>

    <div class="notification" id="notification"></div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const nameInput = document.getElementById('nameInput')
        const pairBtn = document.getElementById('pairBtn')
        const saveBtn = document.getElementById('saveBtn')
        const resultSection = document.getElementById('resultSection')
        const userResultCard = document.getElementById('userResultCard')
        const userPair = document.getElementById('userPair')
        const nameSelect = document.getElementById('nameSelect')
        const userSelect = document.getElementById('userSelect')
        const dashboard = document.getElementById('dashboard')
        const resetBtn = document.getElementById('resetBtn')
        const clearBtn = document.getElementById('clearBtn')
        const loading = document.getElementById('loading')
        const notification = document.getElementById('notification')
        const myResultIcon = document.getElementById('myResultIcon')
        const myResultTooltip = document.getElementById('myResultTooltip')
        const pairsDisplay = document.getElementById('pairsDisplay')
        const pairsContainer = document.getElementById('pairsContainer')

        let currentPairs = {}
        let pairList = []

        // ç¤ºä¾‹äººåï¼ˆå¯ä»¥åˆ é™¤ï¼‰
        nameInput.value = 'å¼ ä¸‰\næå››\nç‹äº”\nèµµå…­\né’±ä¸ƒ\nå­™å…«\nå‘¨ä¹\nå´å'

        pairBtn.addEventListener('click', function () {
          const names = nameInput.value.split('\n').filter((name) => name.trim() !== '')

          if (names.length < 2) {
            showNotification('è¯·è¾“å…¥è‡³å°‘ä¸¤ä¸ªäººåï¼')
            return
          }

          if (names.length % 2 !== 0) {
            showNotification('äººæ•°å¿…é¡»æ˜¯å¶æ•°æ‰èƒ½ä¸¤ä¸¤é…å¯¹ï¼')
            return
          }

          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          loading.style.display = 'block'

          // æ¨¡æ‹Ÿé…å¯¹ç”Ÿæˆè¿‡ç¨‹ï¼Œå¢åŠ è§†è§‰æ•ˆæœ
          setTimeout(() => {
            const pairingResult = performSecretPairing(names)
            currentPairs = pairingResult.pairs
            pairList = pairingResult.pairsList
            displayResults(names, currentPairs)
            displayPairsList(pairList)
            saveBtn.style.display = 'block'
            loading.style.display = 'none'
            createConfetti()
          }, 800)
        })

        nameSelect.addEventListener('change', function () {
          const selectedName = this.value
          if (selectedName && currentPairs[selectedName]) {
            userPair.textContent = currentPairs[selectedName]
          } else {
            userPair.textContent = ''
          }
        })

        saveBtn.addEventListener('click', function () {
          const savedData = {
            pairs: currentPairs,
            pairsList: pairList,
            timestamp: new Date().toISOString()
          }

          localStorage.setItem('secretPairing', JSON.stringify(savedData))
          showNotification('é…å¯¹ç»“æœå·²ä¿å­˜')
        })

        resetBtn.addEventListener('click', function () {
          resultSection.style.display = 'none'
          userPair.textContent = ''
          dashboard.innerHTML = ''
          nameSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©æ‚¨çš„åå­— --</option>'
          saveBtn.style.display = 'none'
          pairsDisplay.style.display = 'none'
          currentPairs = {}
          pairList = []
        })

        clearBtn.addEventListener('click', function () {
          if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„é…å¯¹ç»“æœå—ï¼Ÿ')) {
            localStorage.removeItem('secretPairing')
            showNotification('å·²æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„é…å¯¹ç»“æœ')
            resetBtn.click()
          }
        })

        myResultIcon.addEventListener('click', function () {
          const savedData = JSON.parse(localStorage.getItem('secretPairing') || '{}')

          if (Object.keys(savedData).length > 0) {
            showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåå­—æŸ¥çœ‹é…å¯¹ç»“æœ')
            resultSection.style.display = 'block'
            userSelect.scrollIntoView({ behavior: 'smooth' })
          } else {
            showNotification('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„é…å¯¹ç»“æœ')
          }
        })

        function performSecretPairing(names) {
          const pairs = {}
          const pairsList = []
          const usedPairs = new Set() // ç”¨äºè®°å½•å·²ä½¿ç”¨çš„é…å¯¹ï¼Œé˜²æ­¢é‡å¤
          let availableNames = [...names]

          // é¦–å…ˆæ‰“ä¹±æ•°ç»„é¡ºåº
          shuffleArray(availableNames)

          // åˆ›å»ºé…å¯¹ï¼Œç¡®ä¿æ¯ä¸ªäººåªèƒ½é…å¯¹ä¸€æ¬¡
          while (availableNames.length >= 2) {
            // éšæœºé€‰æ‹©ä¸¤ä¸ªäººå
            const index1 = Math.floor(Math.random() * availableNames.length)
            const name1 = availableNames[index1]
            availableNames.splice(index1, 1)

            // æ‰¾ä¸€ä¸ªä¸ç­‰äºname1ä¸”æœªè¢«é…å¯¹çš„äºº
            let name2 = null
            let attempts = 0

            while (attempts < availableNames.length) {
              const index2 = Math.floor(Math.random() * availableNames.length)
              name2 = availableNames[index2]

              // æ£€æŸ¥è¿™å¯¹ç»„åˆæ˜¯å¦å·²è¢«ä½¿ç”¨ï¼ˆåŒå‘æ£€æŸ¥ï¼‰
              const pairKey1 = `${name1}-${name2}`
              const pairKey2 = `${name2}-${name1}`

              if (name1 !== name2 && !usedPairs.has(pairKey1) && !usedPairs.has(pairKey2)) {
                usedPairs.add(pairKey1)
                usedPairs.add(pairKey2)
                availableNames.splice(index2, 1)
                break
              }

              attempts++
            }

            // å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„é…å¯¹ï¼Œé‡æ–°æ•´ä¸ªå¯¹å¼€å§‹é…è¿‡ç¨‹
            if (name2 === null) {
              return performSecretPairing(names)
            }

            // å»ºç«‹é…å¯¹å…³ç³»
            pairs[name1] = name2
            pairs[name2] = name1
            pairsList.push([name1, name2])
          }

          return { pairs, pairsList }
        }

        function displayResults(names, pairs) {
          // å¡«å……é€‰æ‹©æ¡†
          nameSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©æ‚¨çš„åå­— --</option>'
          names.forEach((name) => {
            const option = document.createElement('option')
            option.value = name
            option.textContent = name
            nameSelect.appendChild(option)
          })

          // åˆ›å»ºäººå‘˜å¡ç‰‡ï¼ˆåªæ˜¾ç¤ºåç§°ï¼Œä¸æ˜¾ç¤ºé…å¯¹ï¼‰
          dashboard.innerHTML = ''
          names.forEach((name) => {
            const personCard = document.createElement('div')
            personCard.className = 'person-card'
            personCard.innerHTML = `
              <div class="person-name">${name}</div>
              <div class="person-pair">ç‚¹å‡»æŸ¥çœ‹é…å¯¹</div>
            `

            personCard.addEventListener('click', function () {
              nameSelect.value = name
              userPair.textContent = pairs[name] || 'æœªæ‰¾åˆ°é…å¯¹'

              // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
              userResultCard.scrollIntoView({ behavior: 'smooth' })
            })

            dashboard.appendChild(personCard)
          })

          resultSection.style.display = 'block'
        }

        function displayPairsList(pairs) {
          // æ˜¾ç¤ºæ‰€æœ‰é…å¯¹ç»“æœ
          pairsContainer.innerHTML = ''
          pairs.forEach((pair) => {
            const pairItem = document.createElement('div')
            pairItem.className = 'pair-item'
            pairItem.textContent = `${pair[0]} &${pair[1]}`
            pairsContainer.appendChild(pairItem)
          })

          pairsDisplay.style.display = 'block'
        }

        function showNotification(message) {
          notification.textContent = message
          notification.classList.add('show')

          setTimeout(() => {
            notification.classList.remove('show')
          }, 3000)
        }

        function createConfetti() {
          const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff9ff3', '#48dbfb']

          for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div')
            confetti.className = 'confetti'
            confetti.style.left = Math.random() * 100 + 'vw'
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]
            confetti.style.width = Math.random() * 10 + 5 + 'px'
            confetti.style.height = confetti.style.width
            confetti.style.animationDuration = Math.random() * 3 + 2 + 's'
            confetti.style.animationDelay = Math.random() * 2 + 's'

            document.body.appendChild(confetti)

            setTimeout(() => {
              confetti.remove()
            }, 5000)
          }
        }

        function shuffleArray(array) {
          const newArray = [...array]
          for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1))
            ;[newArray[i], newArray[j]] = [newArray[j], newArray[i]]
          }
          return newArray
        }

        // åŠ è½½ä¿å­˜çš„ç»“æœ
        const savedData = JSON.parse(localStorage.getItem('secretPairing') || '{}')
        if (Object.keys(savedData).length > 0) {
          showNotification('æ£€æµ‹åˆ°å·²ä¿å­˜çš„é…å¯¹ç»“æœï¼Œç‚¹å‡»å³ä¸‹è§’æŸ¥çœ‹')
        }
      })
    </script>
  </body>
</html>
